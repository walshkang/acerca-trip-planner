{
  "version": "1",
  "nodes": [
    {
      "id": "start",
      "label": "User changes planner filters",
      "type": "start"
    },
    {
      "id": "capture_input",
      "label": "Client updates draft filters and runs local validation",
      "type": "process"
    },
    {
      "id": "preview_count",
      "label": "If valid, request debounced preview count",
      "type": "process"
    },
    {
      "id": "apply_intent",
      "label": "User applies filters (or auto-apply on desktop)",
      "type": "process"
    },
    {
      "id": "validate_schema",
      "label": "Route validates payload against server-owned schema",
      "type": "decision"
    },
    {
      "id": "reject_400",
      "label": "Return 400 invalid_filter_payload + fieldErrors + lastValidCanonicalFilters",
      "type": "end"
    },
    {
      "id": "normalize",
      "label": "Normalize taxonomy aliases and planner slot encoding",
      "type": "process"
    },
    {
      "id": "compose_query",
      "label": "Build deterministic query constraints",
      "type": "process"
    },
    {
      "id": "execute_query",
      "label": "Fetch filtered rows from DB",
      "type": "process"
    },
    {
      "id": "empty_check",
      "label": "Result rows empty?",
      "type": "decision"
    },
    {
      "id": "return_200_empty",
      "label": "Return 200 empty results + canonical filter payload",
      "type": "end"
    },
    {
      "id": "return_200",
      "label": "Return filtered response + canonical filter payload",
      "type": "end"
    }
  ],
  "edges": [
    {
      "from": "start",
      "to": "capture_input",
      "label": "Edit filter controls"
    },
    {
      "from": "capture_input",
      "to": "preview_count",
      "label": "Draft valid"
    },
    {
      "from": "preview_count",
      "to": "apply_intent",
      "label": "Preview shown"
    },
    {
      "from": "capture_input",
      "to": "apply_intent",
      "label": "Manual apply path"
    },
    {
      "from": "apply_intent",
      "to": "validate_schema",
      "label": "POST/PATCH request"
    },
    {
      "from": "validate_schema",
      "to": "reject_400",
      "label": "Invalid"
    },
    {
      "from": "validate_schema",
      "to": "normalize",
      "label": "Valid"
    },
    {
      "from": "normalize",
      "to": "compose_query",
      "label": "Canonicalized"
    },
    {
      "from": "compose_query",
      "to": "execute_query",
      "label": "Constraints ready"
    },
    {
      "from": "execute_query",
      "to": "empty_check",
      "label": "Success"
    },
    {
      "from": "empty_check",
      "to": "return_200_empty",
      "label": "Yes"
    },
    {
      "from": "empty_check",
      "to": "return_200",
      "label": "No"
    }
  ]
}
